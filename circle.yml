machine:
  java:
    version: openjdk8
  services:
    - docker

dependencies:
  cache_directories:
    - .gradle
    - zeus-frontend/.gradle
  override:
    - ./gradlew resolveConfigurations yarn_install --parallel --info --console=plain

test:
  override:
    # We don't run --parallel because of Kotlin compiler bugs (see https://youtrack.jetbrains.com/issue/KT-15562)
    - ./gradlew check --info --console=plain --profile
  post:
    - mkdir -p ${CIRCLE_TEST_REPORTS}/junit/
    - find . -type f -regex ".*/build/test-results/.*xml" -exec cp {} ${CIRCLE_TEST_REPORTS}/junit/ \;

# TODO: enable deployment once everything's sweet

#deployment:
#  hub:
#    branch: /.*/
#    commands:
#      - curl https://raw.githubusercontent.com/quartictech/circleci-utils/develop/circleci-gcloud-login | bash
#      - ./gradlew publish dockerPush --parallel --info --console=plain

general:
  artifacts:
    - build/reports/profile