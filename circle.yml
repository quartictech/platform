machine:
  java:
    version: openjdk8
  node:
    version: 7.2.0
  services:
    - docker

dependencies:
  cache_directories:
    - weyl-frontend/node_modules
    - management-frontend/node_modules
  override:
    - ./gradlew resolveConfigurations npmInstall --parallel

test:
  override:
    - ./gradlew check docker --parallel --info
  post:
    - mkdir -p ${CIRCLE_TEST_REPORTS}/junit/
    - find . -type f -regex ".*/build/test-results/.*xml" -exec cp {} ${CIRCLE_TEST_REPORTS}/junit/ \;

deployment:
  hub:
    branch: /.*/
    commands:
      - curl https://raw.githubusercontent.com/quartictech/circleci-utils/develop/circleci-gcloud-login | bash
      - ./gradlew dockerPush --parallel --info
