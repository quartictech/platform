def env = [BUILD_VERSION: version]

node {
//    version = "8.1.2"
    yarnVersion = "0.24.6"
    download = "true"
}

task yarnLint(type: YarnTask, dependsOn: yarn_install) {
    args = ["run", "lint", "--silent"]
}

task yarnBuild(type: YarnTask, dependsOn: yarn_install) {
    args = ["run", "build", "--silent"]
    environment = env + [NODE_ENV: "production"]
    // TODO: specify input files
    outputs.dir   "${buildDir}/webpack"
}

task yarnStart(type: YarnTask, dependsOn: yarn_install) {
    args = ["start", "--silent"]
    environment = env
    // TODO: specify input files
}

// In a perfect world, we'd just put this in .yarnrc
// However, see this: https://github.com/mapbox/mapbox-gl-js/issues/4885
yarn_install {
    args = ["--mutex", "network"]
}

jar {
    from yarnBuild
}

check.dependsOn yarnLint
